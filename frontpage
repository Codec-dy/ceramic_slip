<?php
/*
 * The home page template file.
 */

get_header(); ?>

	<div class="secondary">
	<?php  // Here we set up the custom query to pull in blog posts

		$args = array(
			'post_type' => 'post',
			'featured' => 'home-page'
		);

		$news_query = new WP_Query( $args );

	?>

	<?php if ( $news_query->have_posts() ) : ?>

		<h2 class="section-heading">News &amp; Announcements</h2>

			<?php 	// Start the Loop for blog posts
				while ( $news_query->have_posts() ) : $news_query->the_post(); ?>

				<?php get_template_part( 'content', 'post' ); ?>

			<?php endwhile; ?>

			<?php wp_reset_postdata(); // IMPORTANT - reset the $post object so the rest of the page works correctly ?>

		<?php else : ?>

	<?php endif; // end Featured posts ?>


	<?php // Here we set up the custom query to pull in events
		  // @todo: Drop off page after expiration date

		$args = array(
			'post_type' => 'classes',
			'featured' => 'home-page'

			/*
			// Jordan
			'meta_key' => 'class_start_date', //(yyyymmdd)
			'orderby' => 'meta_value_num',
			'order' => 'ASC',
			// class_age_range (adult)
			*/
		);

		$events_query = new WP_Query( $args );

	?>

	<?php if ( $events_query->have_posts() ) : ?>

		<h2 class="section-heading">Upcoming Classes</h2>

		<?php  // Start the Loop for events
			while ( $events_query->have_posts() ) : $events_query->the_post(); ?>

			<?php get_template_part( 'content', 'classes' ); ?>

		<?php endwhile; ?>

		<?php wp_reset_postdata(); // IMPORTANT - reset the $post object so the rest of the page works correctly ?>

	<?php else : endif; ?>


	<?php // Here we set up the custom query to pull in events
		  // @todo: Drop off page after expiration date

		$today = date('Ymd');
		$args = array(
			'post_type' => 'events',
			'posts_per_page' => 3,
			'featured' => 'home-page'

			/*'meta_key' => 'event_date_time_%_event_date',
			'orderby' => 'meta_value_num',
			'order' => 'ASC',

			'meta_query' => array(
				array(
			        'key'		=> 'event_date_time_%_event_date',
			        'compare'	=> '<=',
			        'value'		=> $today,
			    ),
    		),*/
		);

		$events_query = new WP_Query( $args );

	?>

	<?php if ( $events_query->have_posts() ) : ?>

		<h2 class="section-heading">Upcoming Events</h2>

		<?php  // Start the Loop for events
			while ( $events_query->have_posts() ) : $events_query->the_post(); ?>

			<?php get_template_part( 'content', 'events' ); ?>

		<?php endwhile; ?>

		<?php wp_reset_postdata(); // IMPORTANT - reset the $post object so the rest of the page works correctly ?>

	<?php else : endif; ?>

	</div><!-- end #secondary -->

	<?php // Here we show the static page entry
		if (have_posts()) : while (have_posts()) : the_post(); ?>

	<div class="primary">

		<h2 class="section-heading">Welcome to ArtHaus</h2>

		<article>
			<?php the_content(); ?>
		</article>

		<?php get_sidebar(); ?>

		<aside class="widget fb-widget" >
			<div class="fb-like-box" data-href="https://www.facebook.com/arthausdecorah" data-height="500px" data-colorscheme="light" data-show-faces="false" data-header="false" data-stream="true" data-show-border="false"></div>
		</aside>

	</div><!-- end #primary -->

	<?php endwhile; ?>

	<?php wp_reset_postdata(); // IMPORTANT - reset the $post object so the rest of the page works correctly ?>

	<?php endif; ?>

<?php get_footer(); ?>
